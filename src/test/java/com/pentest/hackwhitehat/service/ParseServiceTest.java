package com.pentest.hackwhitehat.service;

import com.pentest.hackwhitehat.entity.NmapScan;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;

import java.util.Arrays;
import java.util.List;

class ParseServiceTest {

    private ParseService parseService;

    @BeforeEach
    void setUp() {
        parseService = new ParseService();
    }

    @Test
    void testParseNmapOutput() {
        // Logs de test
        String logs = "Nmap scan report for 192.168.0.1\n" +
                "Host is up\n" +
                "Port 80/tcp is open\n" +
                "Port 443/tcp is open\n";

        // Résultats attendus
        String expectedIpAddress = "192.168.0.1";
        String expectedHostStatus = "Up";
        List<String> expectedOpenPorts = Arrays.asList("Port 80/tcp is open", "Port 443/tcp is open");

        // Appel de la méthode à tester
        NmapScan result = parseService.parseNmapOutput(logs);

        // Vérifications
        Assertions.assertEquals(expectedIpAddress, result.getIpAddress());
        Assertions.assertEquals(expectedHostStatus, result.getHostStatus());
        Assertions.assertEquals(expectedOpenPorts, result.getOpenPorts());
        Assertions.assertEquals(expectedOpenPorts.size(), result.getOpenPorts().size());
        Assertions.assertTrue(result.getOpenPorts().containsAll(expectedOpenPorts));
    }
}
